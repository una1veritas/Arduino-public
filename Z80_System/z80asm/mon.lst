                        ; --------------------------------------
                        ; zasm: assemble "mon.asm"
                        ; date: 2025-09-14 22:40:50
                        ; --------------------------------------


                        ;
0000:                   	org 	0000h
0000:                   rst:
0000: 310002   [10]     	ld 		sp, 0200h
0003: C31500   [20]     	jp  	main
                        ;
                        ;;
                        ; a  ... working reg.
                        ; b  ... dnjz counter
                        ; c  ... nibble value
                        ; de ... start address
                        ; hl ... end address
                        ;
                        	org 	0010h
0010: 210301   [30]     	ld 		hl, mon_cmd
0013: 3600     [40]     	ld 		(hl), 0
0015:                   main:
0015: 3E3E     [ 7]     	ld 		a, '>'
0017: D302     [18]     	out 	(2), a
0019: 3E20     [25]     	ld 		a, ' '
001B: D302     [36]     	out 	(2), a
001D:                   wait_next_char:
001D: CD8F00   [17]     	call 	getchar
0020: D302     [28]     	out 	(2), a 		; echo back
                        
0022: CDD600   [45]     	call 	hex2nibble
0025: FEFF     [52]     	cp 		$ff
0027: 281C     [59|64]  	jr 		z, cmd
0029: 4F       [63]     	ld 		c, a
002A:                   shift_in:
002A: CB11     [ 8]     	rl		c
002C: CB11     [16]     	rl		c
002E: CB11     [24]     	rl		c
0030: CB11     [32]     	rl		c
0032: 0604     [39]     	ld 		b, 4
0034:                   _loop:
0034: CB11     [ 8]     	rl 		c
0036: CB13     [16]     	rl		e
0038: CB12     [24]     	rl 		d
003A: 10F8     [32|37]  	djnz 	_loop
003C: 210401   [42]     	ld 		hl, mon_curr_addr
003F: 7323722B [68]     	ld 		(hl), de
0043: 18D8     [80]     	jr 		wait_next_char
                        
0045:                   cmd:
0045: 79       [ 4]     	ld 		a, c
0046: FE48     [11]     	cp 		'H'
0048: 2001     [18|23]  	jr 		nz, next_cmd1
                        
004A: 76       [22]     	halt
                        
004B:                   next_cmd1:
004B: FE52     [ 7]     	cp 		'R'
004D: 2002     [14|19]  	jr 		nz, next_cmd2
004F: D5       [25]     	push 	de
0050: C9       [35]     	ret
                        
0051:                   next_cmd2:
0051: FE2E     [ 7]     	cp 		'.'
0053: 2004     [14|19]  	jr 		nz, next3
0055: 210301   [24]     	ld 		hl, mon_cmd
0058: 77       [31]     	ld 		(hl), a
                        
0059:                   next3:
0059: FE0D     [ 7]     	cp 		$0d
005B: 2802     [14|19]  	jr 		z, exec_command
                        
005D:                   next4:
005D: 18B6     [12]     	jr 		main
                        
005F:                   exec_command:
005F: CD6400   [17]     	call 	dump_16_byte
0062: 18B1     [29]     	jr 		main
                        
                        ; dump memory b bytes from address stored in addrptr
0064:                   dump_16_byte:
0064: 2A0401   [16]     	ld 		hl, (mon_curr_addr)
0067:                   dump_16_byte_loop:
0067: 7C       [ 4]     	ld 		a, h
0068: CD0001   [21]     	call 	print_a_hex
006B: 7D       [25]     	ld 		a, l
006C: CD0001   [42]     	call 	print_a_hex
006F: 3E20     [49]     	ld 		a, ' '
0071: D302     [60]     	out 	(2), a
0073: 3E3A     [67]     	ld 		a, ':'
0075: D302     [78]     	out 	(2), a
0077: 3E20     [85]     	ld 		a, ' '
0079: D302     [96]     	out 	(2), a
007B: 0610     [103]    	ld 		b, 16
007D:                   dump_16:
007D: 7E       [ 7]     	ld 		a, (hl)
007E: CD0001   [24]     	call 	print_a_hex
0081: 3E20     [31]     	ld 		a, ' '
0083: D302     [42]     	out 	(2), a
0085: 23       [48]     	inc 	hl
0086: 10F5     [56|61]  	djnz 	dump_16
0088:                   dump_16_byte_exit:
0088: 220401   [16]     	ld 		(mon_curr_addr), hl
008B: CD1601   [33]     	call 	print_endl;
008E: C9       [43]     	ret
                        
                        ; read one character from con in 
                        ; returns ascii code in A reg.
008F:                   getchar:
008F: DB00     [11]     	in 		a, (0)
0091: A7       [15]     	and 	a 
0092: 28FB     [22|27]  	jr 		z, getchar
0094: DB01     [33]     	in 		a, (1)
0096: C9       [43]     	ret
                        
                        ; read and store line until the 1st occurrence of cr or nl
                        ; in (hl)
0097:                   getline:
0097: DB00     [11]     	in 		a, (0)		; con status
0099: A7       [15]     	and 	a			; 
009A: 28FB     [22|27]  	jr 		z, getline 	; repeat until available
009C: DB01     [33]     	in 		a, (1)		; getchar
009E: 77       [40]     	ld 		(hl), a		; store
009F: FE0A     [47]     	cp 		10			; if nl
00A1: 2807     [54|59]  	jr 		z, getline_end
00A3: FE0D     [61]     	cp 		13			; if cr
00A5: 2803     [68|73]  	jr 		z, getline_end
00A7: 23       [74]     	inc 	hl			; ++hl
00A8: 10ED     [82|87]  	djnz 	getline		; get next char
00AA:                   getline_end:
00AA: 3600     [10]     	ld 		(hl), 0		; terminate by null
00AC:                   getline_clrbuf:
00AC: DB00     [11]     	in 		a, (0)		; waste remaining chars in con buffer
00AE: A7       [15]     	and 	a
00AF: C8       [20|26]  	ret 	z
00B0: DB01     [31]     	in 		a, (1)
00B2: 18F8     [43]     	jr 		getline_clrbuf
                        
                        
                        ; read hexadecimal string upto 2 or 4 (set in c) 
                        ; bytes from (hl) and return integer val in de
                        ;
00B4:                   hexstr2_de:
00B4: 0E02     [ 7]     	ld 		c, 2
00B6: 1804     [19]     	jr 		hexstr_de
                        
00B8:                   hexstr4_de:
00B8: 0E04     [ 7]     	ld 		c, 4
00BA: 1800     [19]     	jr 		hexstr_de
                        
00BC:                   hexstr_de:
00BC: 110000   [10]         ld      de, 0000h
00BF:                   hexstr_de_lp:
00BF: 7E       [ 7]         ld      a, (hl)
00C0: CDD600   [24]     	call 	hex2nibble
00C3: FEFF     [31]     	cp 		$ff
00C5: C8       [36|42]  	ret 	z
00C6: A7       [40]     	and 	a		; clear Carry bit
00C7: 0604     [47]     	ld 		b, 4
00C9:                   hexstr_de_rl4:
00C9: CB13     [ 8]         rl      e		 ;rotate left entire de
00CB: CB12     [16]         rl      d
00CD: 10FA     [24|29]      djnz    hexstr_de_rl4
00CF: 83       [28]     	add 	e
00D0: 5F       [32]     	ld 		e, a
00D1: 23       [38]         inc     hl
00D2: 0D       [42]     	dec 	c
00D3: 20EA     [49|54]      jr      nz, hexstr_de_lp
00D5: C9       [59]     	ret
                        
                        ; convert one char expressing a hexadecimal digit 
                        ; in A reg. to nibble in A
                        ;
00D6:                   hex2nibble:
00D6: FE61     [ 7]         cp      'a'     ; check whether a lower case
00D8: 3802     [14|19]      jr      c, hex2nibble_digit_or_upper  ; a digit or an upper case if carry set
00DA: E6DF     [21]         and     $df     ; lower case to upper case
00DC:                   hex2nibble_digit_or_upper:
00DC: FE3A     [ 7]         cp      '9' + 1 ; check whether a digit
00DE: 3005     [14|19]      jr      nc, hex2nibble_upper  ; possibly an upper case letter if carry not set
00E0: D630     [21]         sub     a, '0'  ; digit to int value
00E2: 380C     [28|33]      jr      c, hex2nibble_err     ; it was not '0' - '9' 
00E4: C9       [38]         ret
00E5:                   hex2nibble_upper:
00E5: FE47     [ 7]         cp      'F'+1   ; check the digit whether less than 'F'
00E7: 3007     [14|19]      jr      nc, hex2nibble_err      ; error if it is larger than 'F'
00E9: D641     [21]         sub     'A'  	; A - F to integer 0 - 5
00EB: 3803     [28|33]      jr      c, hex2nibble_err       ; it was not 'A' - 'F'
00ED: C60A     [35]         add     a, 10   ; A - F to 10 - 15 by +5
00EF:                   hex2nibble_output:
00EF: C9       [10]         ret
                        
00F0:                   hex2nibble_err:
00F0: 3EFF     [ 7]     	ld 		a, 0xff
00F2: C9       [17]     	ret
                        
                        
                        
00F3:                   print_nibble_hex:
00F3: E60F     [ 7]     	and 	$0f
00F5: C630     [14]     	add 	'0'
00F7: FE3A     [21]     	cp 		':'
00F9: 3802     [28|33]  	jr 		c, print_nibble_hex_out
00FB: C607     [35]     	add 	7
00FD:                   print_nibble_hex_out:
00FD: D302     [11]     	out 	(2), a
00FF: C9       [21]     	ret
                        
0100:                   print_a_hex:
0100: 3E       [ 7]     	push 	af
0101: 20       [14|19]  	rlca
0102: 00       [18]     	rlca
0103: 00       [22]     	rlca
0104: 00       [26]     	rlca
0105: 00F300   [38]     	call 	print_nibble_hex
0108: F1       [48]     	pop 	af
0109: CDF300   [65]     	call 	print_nibble_hex
010C: C9       [75]     	ret
                        
010D:                   print_hl_str:
010D: 7E       [ 7]     	ld	a, (HL)
010E: B7       [11]     	or	a
010F: C8       [16|22]  	ret	z
0110: D302     [27]     	out	(2),a
0112: 23       [33]     	inc HL
0113: C30D01   [43]     	jp	print_hl_str
                        
0116:                   print_endl:
0116: 3E0D     [ 7]     	ld 		a, 13
0118: D302     [18]     	out		(2), a
011A: 3E0A     [25]     	ld 		a, 10
011C: D302     [36]     	out 	(2), a
011E: C9       [46]     	ret
                        
                        
                        	org 	0100h
                        ; monitor working area
0100:                   prompt:
0100: 3E20              	db 	"> "
0102: 00                	db 	0
                        
0103:                   mon_cmd:
0103: 00                	db 		$0
0104:                   mon_curr_addr:
0104: 0000              	dw 		0000h


; +++ segments +++

#CODE          = $0000 =     0,  size = $011F =   287

; +++ global symbols +++

_end                 = $011F =   287          mon.asm:2 (unused)
_loop                = $0034 =    52          mon.asm:36
_size                = $011F =   287          mon.asm:2 (unused)
cmd                  = $0045 =    69          mon.asm:45
dump_16              = $007D =   125          mon.asm:90
dump_16_byte         = $0064 =   100          mon.asm:76
dump_16_byte_exit    = $0088 =   136          mon.asm:97 (unused)
dump_16_byte_loop    = $0067 =   103          mon.asm:78 (unused)
exec_command         = $005F =    95          mon.asm:71
getchar              = $008F =   143          mon.asm:104
getline              = $0097 =   151          mon.asm:113
getline_clrbuf       = $00AC =   172          mon.asm:127
getline_end          = $00AA =   170          mon.asm:125
hex2nibble           = $00D6 =   214          mon.asm:169
hex2nibble_digit_or_upper = $00DC =   220          mon.asm:173
hex2nibble_err       = $00F0 =   240          mon.asm:188
hex2nibble_output    = $00EF =   239          mon.asm:185 (unused)
hex2nibble_upper     = $00E5 =   229          mon.asm:179
hexstr2_de           = $00B4 =   180          mon.asm:138 (unused)
hexstr4_de           = $00B8 =   184          mon.asm:142 (unused)
hexstr_de            = $00BC =   188          mon.asm:146
hexstr_de_lp         = $00BF =   191          mon.asm:148
hexstr_de_rl4        = $00C9 =   201          mon.asm:155
main                 = $0015 =    21          mon.asm:17
mon_cmd              = $0103 =   259          mon.asm:237
mon_curr_addr        = $0104 =   260          mon.asm:239
next3                = $0059 =    89          mon.asm:64
next4                = $005D =    93          mon.asm:68 (unused)
next_cmd1            = $004B =    75          mon.asm:52
next_cmd2            = $0051 =    81          mon.asm:58
print_a_hex          = $0100 =   256          mon.asm:204
print_endl           = $0116 =   278          mon.asm:223
print_hl_str         = $010D =   269          mon.asm:215
print_nibble_hex     = $00F3 =   243          mon.asm:194
print_nibble_hex_out = $00FD =   253          mon.asm:200
prompt               = $0100 =   256          mon.asm:233 (unused)
rst                  = $0000 =     0          mon.asm:3 (unused)
shift_in             = $002A =    42          mon.asm:30 (unused)
wait_next_char       = $001D =    29          mon.asm:22


total time: 0.0015 sec.
no errors
